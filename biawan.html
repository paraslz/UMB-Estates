<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Biawan Estate - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; } /* dark green */
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div id="header-title" class="text-xl font-bold text-gray-900">
                <!-- Title will be populated by JS -->
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "biawan",
                "name": "Biawan Estate (Inti)",
                "reportInfo": "Data based on PA Report (Aug 2025) & Agronomy Report (Nov 2025).",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area",
                        "lines": [
                            "Total Planted: 2,932.90 ha",
                            "Mature: 2,910.90 ha",
                            "Immature: 22.00 ha",
                            "Note: Incl. 940.05 ha transfer from Haruan"
                        ]
                    },
                    "yield": {
                        "title": "Yield/Ha (YTD Oct '25)",
                        "value": "5.33 MT",
                        "note": "45% higher than prev year period"
                    },
                    "cost": {
                        "title": "FFB Cost/Tonne (YTD Jul '25)",
                        "value": "RM 811.90",
                        "note": "Extremely high (Source: PA Aug)"
                    },
                    "labour": {
                        "title": "Labour Status",
                        "value": "Shortage",
                        "note": "1:17 ha ratio; needs 12 more harvesters"
                    },
                     "pests": {
                        "title": "Parthenocarpy",
                        "value": "High Incidence",
                        "note": "Linked to high water table"
                    }
                },
                "keyMetrics": [
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z' /></svg>`, "label": "Drainage Status", "value": "Waterlogged (Critical)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>`, "label": "Manuring Status", "value": "Delayed (~50% Done)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>`, "label": "OER % (YTD Jul '25)", "value": "19.93%" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>`, "label": "Harvester Prod.", "value": "Low (Locals)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>`, "label": "Harvest Interval", "value": "~15 days (Acceptable)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>`, "label": "Nutrient Status", "value": "Low P & N (Leaching)" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["May-25", "Jun-25", "Jul-25"],
                        "ffb": [1987, 2050, 2121.63], 
                        "rainfall": [124, 293, 180], // Placeholder from PA, AR has newer rainfall but keep PA production data for consistency in this chart
                        "note": "*FFB production data from PA Report (May-July 2025). Latest YTD yield is 5.33 MT/ha."
                    },
                    "ageProfile": {
                        "labels": ["Prime Mature (8-19 Yrs)", "Young Mature (4-7 Yrs)", "Immature (<4 Yrs)"],
                        "data": [91, 8, 1],
                        "title": "Biawan Estate - Palm Age Distribution (Nov 2025)",
                        "note": "*Source: Agronomy Report 2/2025, Pg. 10."
                    }
                },
                "observations": [
                    "<b>Parthenocarpy & Waterlogging:</b> High incidence of parthenocarpic bunches (seasonal peak Jun-Oct) linked to high water tables and poor drainage, causing root oxygen stress and poor pollination. <span class='observation-ref'>(AR Pg. 25-30)</span>",
                    "<b>Delayed Manuring Program:</b> The FY 2025/26 manuring is behind schedule (only ~50-60% complete) due to late delivery and focus on completing carry-forward fertilizer. <span class='observation-ref'>(AR Pg. 13-14)</span>",
                    "<b>Crop Recovery Issues:</b> Field losses remain moderately high. Loose fruit collection is inconsistent, sometimes mixed with rotten fruit. Uncollected bunches found in collection drains. <span class='observation-ref'>(AR Pg. 18, 61)</span>",
                    "<b>Harvester Shortage:</b> The estate faces a shortage of harvesters (ratio 1:17 ha). Productivity of local harvesters is low due to shorter working hours. <span class='observation-ref'>(PAR Pg. 17, 64)</span>",
                    "<b>High Production Cost:</b> Production cost is alarmingly high at RM 811.90/MT (as of July), requiring verification. <span class='observation-ref'>(PAR Pg. 69-70)</span>",
                    "<b>Weed Control & Bare Ground:</b> Bare ground conditions due to path spraying and incomplete weed kill were observed. Recommendation to encourage soft grasses (Nephrolepis) instead of bare ground. <span class='observation-ref'>(AR Pg. 42-46)</span>"
                ],
                "reports": {
                    "plantation": {
                        "Executive Summary": "The main priorities are to expedite the rehabilitation of neglected blocks, recruit more harvesters (preferably from outside the province) to address both the shortage and low productivity, and improve the efficiency of spraying operations. (Source: PAR, Pg. 78-79)",
                        "Area Statement": "As of April 2025, mature area is 1,798.10 ha and immature is 194.75 ha. *Note: Area updated in Nov 2025 to 2,932.90 ha via transfer from Haruan. (Source: PAR, Pg. 14-15; AR Pg. 9)",
                        "Labour Statement": "As of August 2025, the estate is short of 12 harvesters (108 available vs. 120 required), with a ratio of 1:17 ha. The Estate Manager plans to recruit 20 new harvesters. (Source: PAR, Pg. 17)",
                        "Staff Establishment": "Staffing levels are adequate. A new Estate Manager, Bpk Victor Ato, was transferred in from May 2025. (Source: PAR, Pg. 20)",
                        "General Charges": "The YTD expenditure to July 2025 was 10% over budget, a contrast to the previous full year which was 13% underspent. (Source: PAR, Pg. 22-24)",
                        "Upkeep Cultivation": "Circle spraying productivity is low (1.9 ha/md), and a switch to low-volume nozzles is recommended. Roads are generally well-graded. (Source: PAR, Pg. 30, 52)",
                        "Harvesting and Collection": "The harvesting interval is good at ~12 days (PA) / 15 days (AR). However, the productivity of local harvesters is low as they often stop work early. (Source: PAR, Pg. 62, 64)",
                        "Crop Production": "YTD July 2025 yield was 3.41 MT/ha, which is encouragingly 28% above the budget of 2.67 MT/ha. (Source: PAR, Pg. 65)",
                        "Production Cost": "The production cost as of July 2025 is extremely high at RM 811.90 per tonne and requires verification by the estate management. (Source: PAR, Pg. 69-70)",
                        "Vehicles Running Cost": "Vehicle costs are generally within budget, but some units were noted to be underutilized and their budgeted running hours should be reviewed. (Source: PAR, Pg. 75)",
                        "Capital Expenditure": "Capital expenditure was underspent for the period. (Source: PAR, Pg. 77)",
                        "Immature": "Rehabilitation work is behind schedule. A major concern is the use of seedlings without emerging spears for supplying, which could result in high failure rates. (Source: PAR, Pg. 15, 60, 78)"
                    },
                    "agronomy": {
                        "Executive Summary": "Overall yield performance has improved (45% increase YTD), but is still limited by flooding and incomplete crop recovery. Key concerns include the persistent delay in manuring (track record of ~50% completion), high incidence of parthenocarpy linked to waterlogging, and unsatisfactory palm nutrient status (N & P variations). The blocking system requires consolidation, and a fresh palm census is needed (last census Oct 2024). Ground vegetation has improved but bare ground from path spraying remains an issue. (Source: AR 2-2025, Pg. 4-7)",
                        "Nutrient Inputs/Progress of Manuring": "The estate has a historically poor track record for fertilizer completion (40% in FY22/23, 61% in FY24/25). As of Oct 2025, the FY25/26 program is behind schedule: Mix B (51%), AS (69%), Kieserite (17%), and RP (0%). Delays are due to late delivery and prioritizing carry-forward fertilizers. <br><br><b>Compost Application:</b> Inconsistent recording noted. Only Block BQ41-P13 achieved full completion. Recommendation: Avoid applying compost in low-lying, flood-prone areas to prevent pathogen risks; apply on higher ground or use alternate-year cycles. (Source: AR 2-2025, Pg. 13-17)",
                        "Agronomic Observation": "<b>Crop Recovery:</b> Harvesting interval is acceptable (<15 days), but loose fruit collection is inconsistent, often unfresh or mixed with rotten fruit. Uncollected bunches were found in drains (e.g., BM49-13A1).<br><br><b>Parthenocarpy:</b> Severe incidence observed, following a seasonal pattern (June-Oct). This is strongly linked to high water tables causing root oxygen stress and poor pollination. A trial using piezometers to regulate water levels is recommended.<br><br><b>Pruning:</b> Quality is generally acceptable, but slight under-pruning noted in palms <15 years (retain 2 subtending fronds). Frond stacking is often untidy.<br><br><b>Weed Control:</b> Four conditions identified, ranging from sparse soft grass to dense ferns. Path spraying has caused undesirable bare ground. Management should aim to establish <i>Nephrolepis</i> soft cover.<br><br><b>Nutrient Status:</b> Leaf analysis reveals high variability in Nitrogen and Phosphorus, likely due to leaching from high water tables. K and Mg levels are generally satisfactory. (Source: AR 2-2025, Pg. 18-57)",
                        "Yield Performance": "The April-October FY2025/26 period recorded a significant <b>45% increase</b> in average FFB yield compared to the same period last year. Improvements were seen across all fields, particularly P15 (262% increase) and P17 (205% increase). However, overall productivity remains below potential due to incomplete crop recovery and prolonged flooding (Nov-Dec 2024) which disrupted harvesting. (Source: AR 2-2025, Pg. 58-62)",
                        "Fertilizer Recommendation": "<b>Crucial Deadline:</b> The FY2025/26 program must NOT be carried forward past April 2026. Only remaining unfinished fertilizer should be used in the FY26/27 program. Avoid application on waterlogged ground.<br><br><b>New Plantings:</b> Apply 600g Controlled Release Fertilizer (20:6:14:3) + 500g Rock Phosphate in the planting hole. No further manuring required for 9 months. (Source: AR 2-2025, Pg. 63)"
                    },
                    "pinfosys": "Not Available"
                },
                "policy": " <div class='policy-item'><p class='font-semibold'>Water Management</p><p class='text-sm text-gray-600'><b>Recommendation:</b> Install piezometers in treatment plots to monitor water levels. Adjust monsoon season water levels to match dry season benchmarks to reduce parthenocarpy.</p></div> <div class='policy-item'><p class='font-semibold'>Manuring & Fertilizing</p><p class='text-sm text-gray-600'><b>Policy Ref: FERT-APP-05:</b> Fertilizer application must adhere to schedule. Do not apply when ground is waterlogged.</p></div> <div class='policy-item'><p class='font-semibold'>Weed Management</p><p class='text-sm text-gray-600'><b>Recommendation:</b> Avoid blanket path spraying which creates bare ground. Preserve soft grasses (Nephrolepis) for moisture conservation.</p></div>"
            };


            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                document.getElementById('header-title').innerText = `${estateData.name} Report`;
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-red-50 text-red-800' :
                                       metric.title.includes('Labour') ? 'bg-purple-50 text-purple-800' : 'bg-yellow-50 text-yellow-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production vs Rainfall (PA Data)</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile (Nov 2025)</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Production (MT)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#ca8a04', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#047857', '#a7f3d0', '#d1fae5'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: false }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);
                
                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (pinfosysDiv && estateData.reports.pinfosys === "Not Available") {
                    pinfosysDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        const isActive = content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active', isActive);
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', () => openPolicyModal(estateData));
            }

            renderEstate();
        });
        
        function openPolicyModal(estate) {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            modalTitle.innerText = `Agricultural Policy Cross-Reference: ${estate.name}`;
            modalContent.innerHTML = estate.policy;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
