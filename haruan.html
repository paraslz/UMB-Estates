<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Haruan Estate - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; } /* dark green */
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div id="header-title" class="text-xl font-bold text-gray-900">
                <!-- Title will be populated by JS -->
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "haruan",
                "name": "Haruan Estate (Inti)",
                "reportInfo": "Data based on PA Report (Aug 2025), Audit Report (May 2025), & Agronomy Report (Nov 2025).",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area",
                        "lines": [
                            "Total Planted: 1,599.96 ha",
                            "Mature: 1,470.18 ha",
                            "Immature: 129.78 ha"
                        ]
                    },
                    "yield": {
                        "title": "Yield/Ha (YTD)",
                        "value": "9.35 MT",
                        "note": "As of Oct 2025 (Source: AR)"
                    },
                    "cost": {
                        "title": "FFB Cost/Tonne (YTD vs Budget)",
                        "value": "RM 628 / RM 356",
                        "note": "76% higher than budget (as of July 2025)"
                    },
                    "labour": {
                        "title": "Labour Status",
                        "value": "Adequate",
                        "note": "1:8 ha ratio"
                    },
                     "pests": {
                        "title": "Nutrient Status",
                        "value": "Improving",
                        "note": "K Deficiency in some blocks"
                    }
                },
                "keyMetrics": [
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>`, "label": "Harvester Ratio", "value": "1:18 ha (Sufficient)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>`, "label": "P&D Status", "value": "Under Control" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>`, "label": "OER % (YTD July '25)", "value": "19.93%" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>`, "label": "Weeding Cost", "value": "173% Over Budget" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>`, "label": "Harvest Interval", "value": "Satisfactory (Source: AR)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>`, "label": "Production Cost", "value": "76% Over Budget" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct"],
                        "ffb": [2237.9, 2253.5, 2193.5, 0, 0, 0, 0, 0, 0, 0], // Placeholder: Retained specific known values for May-Jul context
                        "rainfall": [485, 280, 328, 200, 129, 128, 47, 217, 169, 269], // Source: AR Appendix 2
                        "note": "*Rainfall 2025 (AR Appendix 2). FFB Data incomplete for full year chart."
                    },
                    "ageProfile": {
                        "labels": ["Prime Mature (2012-2016)", "Young Mature (2017-2020)", "Immature (2022-2025)"],
                        "data": [1263.5, 206.6, 129.8], // Calculated from AR Table 1
                        "title": "Haruan Estate - Palm Age Distribution (2025)",
                        "note": "*Source: Agronomy Report 2/2025, Pg. 8."
                    }
                },
                "observations": [
                    "<b>Low Harvester Productivity (PA Report):</b> Averages 1.27 MT/man-day, which is considered low for the palm's prime age profile. <span class='observation-ref'>(PAR Pg. 66)</span>",
                    "<b>High Weeding Cost (PA Report):</b> Weeding costs were 173% over budget due to unbudgeted manual slashing and rehabilitation works. <span class='observation-ref'>(PAR Pg. 29)</span>",
                    "<b>Manuring Delays (Agronomy Report):</b> The FY25/26 manuring program is behind schedule, particularly for Kieserite (50% complete) and Compound (56% complete). <span class='observation-ref'>(AR Pg. 15-17)</span>",
                    "<b>Water Management Issues (Agronomy Report):</b> High water tables in P12, P13, and P16 are disrupting field operations, including harvesting and manuring. <span class='observation-ref'>(AR Pg. 38, 45)</span>",
                    "<b>Loose Fruit Collection (Agronomy Report):</b> Quality is suboptimal with oxidized loose fruits found within palm circles (e.g., P15HK46), indicating poor collection standards. <span class='observation-ref'>(AR Pg. 27)</span>",
                    "<b>Specific Nutrient Deficiency (Agronomy Report):</b> 'Orange spotting' symptoms indicative of Potassium (K) deficiency were observed in P12, P13, and P16. <span class='observation-ref'>(AR Pg. 36)</span>"
                ],
                "reports": {
                     "plantation": {
                        "Executive Summary": "Estate performance is acceptable. While YTD production (as of July 2025) is 18% above budget, the ex-estate cost per tonne is 76% higher than budget. Key priorities are to improve harvester productivity (currently 1.27 MT/md), reduce high weeding costs, and expedite road upgrades to eliminate costly internal FFB transport. (Source: PAR, Pg. 4-9, 83-85)",
                        "Area Statement": "As of July 2025, the total planted area is 1,583.08 ha, with 1,470.02 ha mature and 113.06 ha immature. 86% of the mature palms are in their prime (9-13 years old), covering 1,264.05 ha. (Source: PAR, Pg. 11, 16)",
                        "Labour Statement": "As of July 2025, the estate has 308 workers, giving an adequate ratio of 1 worker to 8 ha. The harvester ratio is 1 to 18 ha, which is considered sufficient for the current crop load. (Source: PAR, Pg. 18-19)",
                        "Staff Establishment": "The staff establishment is satisfactory, with an Assistant Manager to land ratio of 1 to 507 ha, covering both Inti and Plasma areas. (Source: PAR, Pg. 17)",
                        "General Charges": "The YTD expenditure (as of July 2025) is 43% higher than the seasonal budget, mainly driven by overspends on staff costs and office expenses. The previous full-year cost (FY2024/25) was 27% over budget. (Source: PAR, Pg. 21, 24)",
                        "Upkeep Cultivation": "Weeding cost for the full year 2024/25 was 173% over budget due to extensive unbudgeted work including manual slashing and creating raised harvester paths in flood-prone areas. The estate is now using low-volume sprayers, which has improved productivity. (Source: PAR, Pg. 29-30)",
                        "Harvesting and Collection": "YTD costs (as of July 2025) are 28% higher than budget. Harvester productivity is low, averaging 1.27 MT/man-day. Internal transport for FFB evacuation remains a significant extra cost and should be phased out with road improvements. (Source: PAR, Pg. 66-68, 72)",
                        "Crop Production": "The estate produced 6,684.96 tons YTD (as of July 2025), which is 18% above the seasonal budget. The YTD yield per hectare is 4.55 tons. (Source: PAR, Pg. 74)",
                        "Production Cost": "Ex-estate cost per tonne YTD (as of July 2025) is IDR 2,143,687 (RM 628), which is 76% higher than the seasonal budget, driven by high upkeep expenditure. (Source: PAR, Pg. 78)",
                        "Vehicles Running Cost": "Average running costs for most vehicles are acceptable. However, three Mini Tractor Startrac units show high costs per hour compared to budget and require monitoring. (Source: PAR, Pg. 80)",
                        "Capital Expenditure": "Expenditure on Capital Expenditure is noted as acceptable. (Source: PAR, Pg. 8)",
                        "Immature": "The total immature area is 113.06 ha. The maturity of the 50.12 ha area planted in 2020 has been postponed due to high supplying. For the 2024 planting, land preparation and mounding are in progress. (Source: PAR, Pg. 81-82)"
                    },
                    "agronomy": {
                        "Executive Summary": "Crop recovery has shown improvement, but loose fruit collection quality remains suboptimal with oxidized fruits detected. Manuring progress has fallen behind schedule due to late deliveries and flooding. While overall yields have improved, Block P16 remains significantly below potential. (Source: AR 2/2025, Pg. 4-6)",
                        "Nutrient Inputs/Progress of Manuring": "Total fertilizer application reached 2,951 MT (150% of plan) largely due to clearing carry-over stocks. However, current year programs are delayed: Kieserite (50%), HGFB (98%), MOP (67%), and Compound (56%) are behind schedule. Specific delays noted for Mixture B in P13/P17 and ZA in P13/P14/P16. Compost application reached 3,967 MT but coverage is uneven at only 27% of the designated area. (Source: AR 2/2025, Pg. 15-22)",
                        "Agronomic Observation": "<b>Harvesting:</b> 135 harvesters (1:15 ha) achieving satisfactory intervals of 7-9 days. Loose fruit collection is poor in P15HK46.<br><b>Pruning:</b> 37% of annual program completed. Under-pruning noted in P13HG41; over-pruning in young mature areas.<br><b>Water Mgmt:</b> High water tables in P12, P13, P15, and P16 are disrupting operations.<br><b>Weeding:</b> Inter-row weeding delayed in P12, P13, P15, P16. Jungle woodies present in P12HJ44 and P13HH39. (Source: AR 2/2025, Pg. 26-50)",
                        "Yield Performance": "Average yield as of Oct 2025 is 9.35 MT/ha. Most fields showed yield gains, with P20 recording a massive increase to 6.40 MT/ha. However, P16 is underperforming at <8 MT/ha. Harvesting rounds achieved 102% of target. (Source: AR 2/2025, Pg. 67-68)",
                        "Fertilizer Recommendation": "The FY2026/2027 programme has been drafted (Appendix 1). For new supply palms, the estate is advised to use Controlled Release Fertilizer (CRF) at 600g/hole + 500g RP during transplanting to eliminate manuring needs for 9 months. Inorganic fertilizer rates should be reduced in areas receiving full compost application. (Source: AR 2/2025, Pg. 71-75)"
                    },
                    "audit": {
                        "Overall Rating": "Marginally Deficient. The audit found that while most key controls were applied, certain important controls lacked consistency or effectiveness, requiring timely corrective action from management. (Source: Audit Rpt, Pg. 2)",
                        "High Manual Slashing Cost": "Field maintenance costs were excessively high due to uncontrolled man-day allocation for manual slashing, poor cost monitoring, and overlapping daily-rated and piece-rated payments for the same blocks. The audit noted a lack of supervision and accountability. (Source: Audit Rpt, Pg. 2-7)",
                        "Wages Overpayment": "Total overpayment of IDR 4,788,796 was identified due to a system bug causing double man-day payments, paying for more hectares than available in a block, and fictitious wage claims by a Field Mandore. (Source: Audit Rpt, Pg. 10-14)",
                        "Uncollected Harvested Bunches": "A field visit found 409 harvested FFB bunches left uncollected for up to 29 days. This was attributed to poor supervision, lack of follow-up, and failure to use a bunch count chit system for traceability. (Source: Audit Rpt, Pg. 15-18)"
                    }
                },
                 "policy": " <div class='policy-item'><p class='font-semibold'>Weeding Practice</p><p class='text-sm text-gray-600'><b>Policy Ref: WEED-CHEM-02:</b> Utilize low-volume nozzle pumps with pure Glyphosate for circular spraying to enhance productivity and achieve longer weed control. Avoid blanket spraying where possible to promote soft grasses. (PAR Pg. 5)</p></div> <div class='policy-item'><p class='font-semibold'>Manuring & Fertilizing</p><p class='text-sm text-gray-600'><b>Policy Ref: FERT-APP-03:</b> The use of wheelbarrows is proven to enhance fertilizer distribution productivity and improve application quality compared to using buckets. (PAR Pg. 5)</p></div> <div class='policy-item'><p class='font-semibold'>Pruning & Harvesting</p><p class='text-sm text-gray-600'><b>Policy Ref: HARV-STD-02:</b> Harvesting intervals should be maintained between 10-15 days to minimize over-ripe bunches and loose fruit loss. (PAR Pg. 65)</p><p class='text-sm text-gray-600'><b>Policy Ref: PRUNE-STD-01:</b> Over-pruning is to be avoided. In young mature palms, retain at least 2 to 3 fronds below the lowest bunch. (PAR Pg. 55)</p></div>"
            };


            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                document.getElementById('header-title').innerText = `${estateData.name} Report`;
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' :
                                       metric.title.includes('Labour') ? 'bg-purple-50 text-purple-800' : 'bg-red-50 text-red-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Rainfall Profile (2025)</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-audit" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Audited Report Details</button>
                            <div id="${estate.id}-audit" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                // { label: 'FFB Production (MT)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#ca8a04', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { display: false, type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: true } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#047857', '#a7f3d0', '#fde047', '#facc15'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: false }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                const auditDiv = document.getElementById(`${estateData.id}-audit`);

                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                 if (auditDiv && estateData.reports.audit) {
                    auditDiv.innerHTML = Object.entries(estateData.reports.audit).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        const isActive = content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active', isActive);
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', () => openPolicyModal(estateData));
            }

            renderEstate();
        });
        
        function openPolicyModal(estate) {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            modalTitle.innerText = `Agricultural Policy Cross-Reference: ${estate.name}`;
            modalContent.innerHTML = estate.policy;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
