<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>MLP 3 Estate - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; } /* dark green */
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div id="header-title" class="text-xl font-bold text-gray-900">
                <!-- Title will be populated by JS -->
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "mlp3",
                "name": "MLP 3 Estate",
                "reportInfo": "Data based on Agronomy Report (23 Oct 2025), PA Report (May 2025) & Audit Report (May 2025).",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area",
                        "lines": [
                            "Total Planted: 1,755.70 ha",
                            "Mature: 1,755.70 ha",
                            "Prime: 100% Mature"
                        ]
                    },
                    "yield": {
                        "title": "Yield/Ha (YTD Actual / Budget)",
                        "value": "13.24 / N/A MT",
                        "note": "Budget N/A in report. +12% vs Last Year (11.83)"
                    },
                    "cost": {
                        "title": "FFB Cost/Tonne (FY 24/25 vs Budget)",
                        "value": "RM 267.74 / RM 279.41",
                        "note": "Based on PA Report (May 2025)"
                    },
                    "labour": {
                        "title": "Manuring Status",
                        "value": "Recovering",
                        "note": "Catching up after initial delays"
                    },
                     "pests": {
                        "title": "Pest/Disease Status",
                        "value": "Ganoderma Spreading",
                        "note": "Spread to 5 new blocks (A02, A04, A05, B23, B24)"
                    }
                },
                "keyMetrics": [
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656-.126-1.283-.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>`, "label": "Harvester Ratio", "value": "1:18 ha (Adequate)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>`, "label": "Ganoderma", "value": "Spreading (Blocks A08->Others)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>`, "label": "Nutrient Status", "value": "Magnesium Deficiency (A09)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>`, "label": "Weeding", "value": "Delayed (Inter-row)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>`, "label": "Harvest Interval", "value": "~15 Days (Improving)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>`, "label": "Manuring", "value": "Catching Up (Some delays)" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["May-25", "Jun-25", "Jul-25", "Aug-25", "Sep-25", "Oct-25"],
                        "ffb": [], // Monthly FFB detailed numbers not explicitly in snippet
                        "rainfall": [445, 308, 309, 309, 94, 178],
                        "note": "*Rainfall data May-Oct 2025. Yield data shows YTD improvement of 12%. (Source: AR 2/2025 Pg. 46)"
                    },
                    "ageProfile": {
                        "labels": ["Prime Mature (8-19 Yrs)"],
                        "data": [100],
                        "title": "MLP 3 Estate - Palm Age Distribution",
                        "note": "*Source: Agronomy Report 2/2025, Pg. 7."
                    }
                },
                "observations": [
                    "<b>Ganoderma Spreading (Critical):</b> Infection has spread from Block A08 to A02, A04, A05, B23, and B24. Mortality is currently <1% (49 palms), but the spread is concerning. Deboling (1.5m x 1.5m x 1.5m) has not been carried out due to machinery limitations. <span class='observation-ref'>(AR 2/2025 Pg. 4, 35)</span>",
                    "<b>Magnesium Deficiency:</b> Localized Magnesium deficiency observed in Block A09 (yellowish/orange fronds). Leaf analysis confirms low Mg levels. Corrective manuring required. <span class='observation-ref'>(AR 2/2025 Pg. 21)</span>",
                    "<b>Weeding Delays:</b> Inter-row spraying is significantly delayed, particularly in Division C. Undesirable weeds (Clidemia hirta, etc.) are present. Circle spraying is generally acceptable but delayed in some blocks. <span class='observation-ref'>(AR 2/2025 Pg. 30-31)</span>",
                    "<b>Audit - Payroll & Attendance:</b> (Previously Reported) Non-payment of sick leave and manipulation of attendance records (using photos instead of live capture) by Field Staff remains a compliance issue. <span class='observation-ref'>(Audit May 2025 Pg. 3-7)</span>",
                    "<b>Manuring Progress:</b> FY2024/25 program completed. FY2025/26 started with 1-3 month delays in some blocks (Mix B, RP) but is now catching up. Application quality is generally acceptable. <span class='observation-ref'>(AR 2/2025 Pg. 10-11)</span>",
                    "<b>Harvesting Operations:</b> Intervals have improved to ~15 days in most blocks (07A, 08A, 11A). Delays persist in hilly blocks (09B, 10B) due to terrain/weather. Crop quality is generally acceptable. <span class='observation-ref'>(AR 2/2025 Pg. 14-15)</span>"
                ],
                "reports": {
                    "plantation": {
                        "Executive Summary": "The estate's performance is acceptable with satisfactory crop production and cost control. The main challenge is to improve weeding and road conditions. (Source: PA May 2025, Pg. 7, 45-46)",
                        "Area Statement": "The planted area is 1,755.70 ha, all of which is in the prime mature stage (12-18 years old). (Source: PA May 2025, Pg. 10-12)",
                        "Labour Statement": "The labour force of 186 workers is adequate, with a worker-to-land ratio of 1:9 ha. (Source: PA May 2025, Pg. 15)",
                        "General Charges": "General charges are 18% below budget and are satisfactory. (Source: PA May 2025, Pg. 17)",
                        "Upkeep Cultivation": "The total upkeep cost is 1% below budget. Weeding programs are behind schedule. (Source: PA May 2025, Pg. 20, 22)",
                        "Harvesting and Collection": "The total harvesting cost of RM 134.54/tonne is 3% above budget. (Source: PA May 2025, Pg. 37-38)",
                        "Crop Production": "FFB production for the year (FY 23/24) was 38,310 MT. (Source: PA May 2025, Pg. 41)",
                        "Production Cost": "The ex-estate cost of production is RM 267.74/tonne, 4% below budget and satisfactory. (Source: PA May 2025, Pg. 42)",
                        "Immature": "N/A"
                    },
                    "agronomy": {
                        "Executive Summary": "Yield performance has improved significantly, recording a 12% increase year-to-date compared to the previous financial year. However, concerns remain regarding the incomplete manuring from FY2024/25, though the current FY2025/26 program is recovering from initial delays. Harvesting intervals have been shortened to 15 days in most areas, but hilly terrain blocks still face delays. Magnesium deficiency has been identified as a key issue in Block A09, requiring corrective action. Ground upkeep is mixed, with weeding progress slower than expected, leading to weedy conditions in certain blocks. While Ganoderma infection is currently insignificant (<1%), sanitation (deboling) has not yet been carried out. (Source: AR 2/2025 Pg. 4-6)",
                        "Nutrient Inputs/Progress of Manuring": "The FY2025/2026 manuring program is progressing well despite early delays. Current completion status: Mixture A (99%), Mixture B (80%), Kieserite (98%), and Rock Phosphate (60%). Delays of 1-3 months were noted in specific blocks (e.g., Mix B in Division C). Application quality is generally acceptable, though some broadcasting was observed too close to terrace lips and palm bases in Block A08. Sub-soil application in Block A01 was done correctly. Old stock of NK Mix (31.15 MT) is still in store and requires prioritization. (Source: AR 2/2025 Pg. 10-13)",
                        "Agronomic Observation": "<b>Harvesting:</b> Intervals have generally improved to ~15 days. However, blocks 09B, 10B, 11B, and 13C experienced extensions due to accessibility issues during rainy periods. Loose fruit collection is poor in ravine and rehab areas. <br><b>Vegetation:</b> Inter-row spraying is significantly delayed, particularly in Division C. VOPs were observed in circles (A07-A09). Undesirable weeds like Clidemia hirta are present. <br><b>Pruning:</b> Generally acceptable, though frond stacking in weeded circles needs correction to avoid disrupting operations. <br><b>Pest & Disease:</b> Ganoderma has spread from A08 to A02, A04, A05, B23, and B24 (Total 49 dead palms). Deboling is delayed due to machinery limitations. Rat damage is minor. <br><b>Nutrient Status:</b> Magnesium deficiency confirmed in Block A09 with yellowish/orange fronds; foliar analysis shows low Mg but normal N, P, and K levels. (Source: AR 2/2025 Pg. 14-36)",
                        "Yield Performance": "As of October 2025 (Period 6), the estate achieved a yield of 13.24 MT/Ha, representing a 12% increase compared to the same period last year (11.83 MT/Ha). All fields recorded growth, with Block 11B showing the highest improvement (16%). To sustain this, road maintenance—specifically gravelling in rehabilitated blocks like B22—must be expedited before the monsoon season to ensure crop evacuation. (Source: AR 2/2025 Pg. 37-38)",
                        "Fertilizer Recommendation": "The fertilizer program for FY2025/2026 remains unchanged. The recommendation for FY2026/2027 has been drafted and is attached in Appendix 2. Sub-soil application methods are to be continued in Blocks A01 and A05, and extended to Blocks 30 and 31. (Source: AR 2/2025 Pg. 39)"
                    },
                    "pinfosys": {
                        "CEO Financial Summary": "N/A",
                        "Summary of Oil Palm Expenditure": "N/A"
                    },
                    "audit": {
                        "Overall Rating": "Marginally Deficient. While most key controls are applied, some important controls lack consistency or effectiveness. (Source: Audit May 2025 Pg. 2)",
                        "Payroll and Personnel": "Weaknesses identified, including: <br>1. Non-payment of entitled paid sick leave. <br>2. Irregular Quarto Connects attendance entries (e.g., late at night) using photos instead of live biometric capture. (Source: Audit May 2025 Pg. 3-5)",
                        "Oil Palm Operations": "Enhancements needed for FFB transport: <br>1. Discrepancies in 'Time Out' and 'Mill Time In'. <br>2. Use of unregistered lorries. <br>3. Significant FFB backlog due to poor road conditions and contractor delays. (Source: Audit May 2025 Pg. 8-14)",
                        "Manuring": "FY 24/25 manuring in rehabilitation Block 3CC42 was incomplete/delayed due to accessibility. (Source: Audit May 2025 Pg. 20-21)"
                    }
                },
                "policy": " <div class='policy-item'><p class='font-semibold'>Ganoderma Control</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-Gano-01:</b> For infected palms, immediate sanitation via deboling (1.5m x 1.5m x 1.5m pit) is required to prevent spread.</p></div> <div class='policy-item'><p class='font-semibold'>Nutrient Management</p><p class='text-sm text-gray-600'><b>Policy Ref: SOIL-MG-01:</b> Correct Magnesium deficiency through Kieserite application or specific fertilizer mix as per Agronomist recommendation.</p></div> <div class='policy-item'><p class='font-semibold'>Manuring & Fertilizing</p><p class='text-sm text-gray-600'><b>Policy Ref: FERT-APP-05:</b> Fertilizer application must strictly adhere to the schedule. Broadcasting must be done at the edge of the weeded circle, not on terrace lips.</p></div> <div class='policy-item'><p class='font-semibold'>Harvesting Standards</p><p class='text-sm text-gray-600'><b>Policy Ref: HARV-STD-02:</b> Maintain harvesting intervals below 15 days. In hilly terrain, ensure road maintenance to prevent skipped rounds.</p></div>"
            };


            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                document.getElementById('header-title').innerText = `${estateData.name} Report`;
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' :
                                       metric.title.includes('Manuring') ? 'bg-yellow-50 text-yellow-800' : 
                                       metric.title.includes('Pest') ? 'bg-red-50 text-red-800' : 'bg-gray-50 text-gray-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                // Check if we have data to show the chart
                const productionChartHTML = (estate.chartData.production.labels && estate.chartData.production.labels.length > 0) ?
                    `<div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div>` :
                    `<div class="chart-container flex items-center justify-center bg-gray-50 rounded-lg p-4"><p class="text-gray-500 text-center">Chart data unavailable.</p></div>`;

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Rainfall Analysis (May - Oct 2025)</h3>${productionChartHTML}<p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        
                        <div class="mb-8">
                            <h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3>
                            <ul id="observations-list" class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul>
                        </div>
                        
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-gray-800 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-green-900 text-white p-3 rounded-md hover:bg-green-800 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-green-900 text-white p-3 rounded-md hover:bg-green-800 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-green-900 text-white p-3 rounded-md hover:bg-green-800 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-audit" class="dropdown-btn w-full text-left bg-green-900 text-white p-3 rounded-md hover:bg-green-800 transition">Audit Report Details</button>
                            <div id="${estate.id}-audit" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx && estateData.chartData.production.labels && estateData.chartData.production.labels.length > 0) {
                    const datasets = [];
                    // Only adding rainfall as FFB monthly data wasn't explicitly provided in the PDF summary table snippet
                    if (estateData.chartData.production.rainfall && estateData.chartData.production.rainfall.length > 0) {
                        datasets.push({ label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' });
                    }

                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: datasets
                        },
                        options: { 
                            responsive: true, 
                            maintainAspectRatio: false, 
                            scales: { 
                                x: { grid: { display: false } }, 
                                'y-rainfall': { type: 'linear', position: 'left', title: { display: true, text: 'Rainfall (mm)' } } 
                            } 
                        }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx && estateData.chartData.ageProfile.data && estateData.chartData.ageProfile.data.length > 0) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#047857', '#34d399', '#a7f3d0'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: false }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);
                const auditDiv = document.getElementById(`${estateData.id}-audit`);

                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (pinfosysDiv && estateData.reports.pinfosys) {
                    if (typeof estateData.reports.pinfosys === 'string') {
                         pinfosysDiv.innerHTML = `<p class="text-sm text-gray-600">${estateData.reports.pinfosys}</p>`;
                    } else {
                        pinfosysDiv.innerHTML = Object.entries(estateData.reports.pinfosys).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                    }
                }
                 if (auditDiv && estateData.reports.audit) {
                    auditDiv.innerHTML = Object.entries(estateData.reports.audit).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        const isActive = content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active', isActive);
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', () => openPolicyModal(estateData));
            }

            renderEstate();
        });
        
        function openPolicyModal(estate) {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            modalTitle.innerText = `Agricultural Policy Cross-Reference: ${estate.name}`;
            modalContent.innerHTML = estate.policy;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
