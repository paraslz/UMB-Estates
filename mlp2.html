<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>MLP 2 Estate - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; } /* dark green */
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div id="header-title" class="text-xl font-bold text-gray-900">
                <!-- Title will be populated by JS -->
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "mlp2",
                "name": "MLP 2 Estate",
                "reportInfo": "Data based on PA Report (Oct 2025), Agronomy Report (Sep 2025) & Audit Report (Jul 2025).",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area (PA Oct '25)",
                        "lines": [
                            "Total Planted: 1,365.85 ha",
                            "Mature: 1,248.63 ha",
                            "Immature: 100.56 ha",
                            "Cocoa: 16.66 ha"
                        ]
                    },
                    "yield": {
                        "title": "Yield/Ha (YTD Sep '25)",
                        "value": "10.68 / 10.05 MT",
                        "note": "6% above budget (5 months)"
                    },
                    "cost": {
                        "title": "FFB Cost/Tonne (YTD Sep '25)",
                        "value": "RM 275 / RM 308",
                        "note": "11% below budget (Ex-Estate)"
                    },
                    "labour": {
                        "title": "Labour Status",
                        "value": "Mixed",
                        "note": "Harvesters adequate; Upkeep shortage"
                    },
                     "audit": {
                        "title": "Audit Rating (Jul 2025)",
                        "value": "Marginally Deficient",
                        "note": "Issues in FFB quality & vehicle docs"
                    }
                },
                "keyMetrics": [
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>`, "label": "Harvester Ratio", "value": "1:14 ha (Adequate)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636' /></svg>`, "label": "FFB Rejection (Jul '25)", "value": "High (Avg 3%)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>`, "label": "OER % (YTD)", "value": "20.25%" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>`, "label": "Weeding/Spraying", "value": "Delayed (Breakdowns)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>`, "label": "Harvest Interval", "value": "11 days (Good)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>`, "label": "P&D Status", "value": "Under Control" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["May-25", "Jun-25", "Jul-25", "Aug-25", "Sep-25"],
                        "ffb": [2600, 2500, 2800, 2700, 2731], 
                        "rainfall": [423, 65, 27, 180, 200],
                        "note": "*Chart estimates based on 5-month totals. Detailed monthly breakdown not provided in summary."
                    },
                    "ageProfile": {
                        "labels": ["Prime Mature (8-19 Yrs)", "Immature (<4 Yrs)"],
                        "data": [92, 8],
                        "title": "MLP 2 Estate - Palm Age Distribution",
                        "note": "*Source: PA Report 2/2025, Area Statement."
                    }
                },
                "observations": [
                    "<b>Severe Disruption from Tractor Breakdowns:</b> Frequent tractor breakdowns are critically impacting operations, causing significant delays in manuring (only 33% complete) and spraying (40-53% complete). This risks future crop performance. <span class='observation-ref'>(PA Pg. 28, 33, 46, 79)</span>",
                    "<b>Harvesting Standards & Loose Fruit:</b> While harvester productivity has improved (2.64 MT/md), standards remain an issue. High numbers of unripe bunches and uncollected loose fruits were observed. Audit (Jul '25) confirmed 3% rejection rate. <span class='observation-ref'>(PA Pg. 62, 79; Audit Pg. 3)</span>",
                    "<b>Labour Shortage in Upkeep:</b> While harvesting strength is adequate, there is a critical shortage of workers for manuring (-15) and spraying (-23), exacerbating the delays caused by machinery issues. <span class='observation-ref'>(PA Pg. 15-16)</span>",
                    "<b>Vehicle Cost Control:</b> High maintenance costs were recorded for tractors due to frequent breakdowns. Audit also noted weaknesses in vehicle documentation, including low utilization with full pay. <span class='observation-ref'>(PA Pg. 70; Audit Pg. 12-15)</span>",
                    "<b>Steep Terrain Rehabilitation:</b> Rehabilitation of Block P11/B39 is challenging due to extreme terrain and steep roads. Recommendation to rehabilitate only half the hill to minimize road damage and erosion. <span class='observation-ref'>(PA Pg. 12, 78)</span>"
                ],
                "reports": {
                    "plantation": {
                        "Executive Summary": "Performance is acceptable with yield 6% above budget (10.68 MT/ha YTD Sep). However, upkeep programs (weeding, manuring) are seriously delayed due to frequent tractor breakdowns and labour shortages in those specific divisions. (Source: PA 2/2025, Pg. 78-79)",
                        "Area Statement": "Total planted area is 1,365.85 ha, comprising 1,248.63 ha mature oil palm, 100.56 ha immature, and 16.66 ha cocoa. (Source: PA 2/2025, Pg. 11)",
                        "Labour Statement": "Harvester strength is adequate (86 workers, 1:14 ha ratio). However, there is a shortage of 15 manuring workers and 23 spraying workers. Total checkroll strength is 192. (Source: PA 2/2025, Pg. 15-16)",
                        "Staff Establishment": "Staffing is adequate with no recent changes. (Source: PA 2/2025, Pg. 17-18)",
                        "General Charges": "Underspent by 6% (RM 768/ha vs Budget RM 816/ha). Overspending noted in Staff EPF (due to increments) and Labour Welfare. (Source: PA 2/2025, Pg. 22-23)",
                        "Upkeep Cultivation": "Underspent by 30% due to work delays. Circle spraying is only 40% completed and Selective spraying 53% completed. These delays are largely attributed to tractor breakdowns interrupting water supply. (Source: PA 2/2025, Pg. 26, 28, 33)",
                        "Harvesting and Collection": "Cost is high at RM 134/MT (Budget RM 120/MT) due to unbudgeted double pay for Sunday work. Productivity has improved to ~2.64 MT/md. Harvesting rounds achieved: 8.5 (Budget 15). Interval: 11 days. (Source: PA 2/2025, Pg. 57-61)",
                        "Crop Production": "FFB production for the 5-month period (May-Sep 2025) was 13,331 MT, which is 8% above the budget of 12,306 MT. (Source: PA 2/2025, Pg. 64)",
                        "Production Cost": "Ex-estate cost of production is RM 275/tonne, which is 11% below the budget of RM 308/tonne, primarily due to higher crop volume. (Source: PA 2/2025, Pg. 67)",
                        "Vehicles Running Cost": "Tractor maintenance costs are very high due to frequent breakdowns, particularly for 3 specific units. This is a critical operational bottleneck. (Source: PA 2/2025, Pg. 70)",
                        "Capital Expenditure": "Capex is underspent. Building and road projects are in progress. (Source: PA 2/2025, Pg. 74)",
                        "Immature": "Planting of 60 ha is completed, with the balance 40 ha expected by November. Seedlings were noted to be tall and require pruning. (Source: PA 2/2025, Pg. 75)"
                    },
                    "agronomy": {
                        "Executive Summary": "Yield performance shows a 7% increase YTD (Aug 2025). However, several limiting factors persist, including extended harvesting intervals, delayed fertilizer application for FY25/26, and unsatisfactory field vegetation. Pest and disease are under control. (Source: AR 2/2025, Pg. 4-6)",
                        "Nutrient inputs progress of manuring": "The FY24/25 program was completed with minor delays. The FY25/26 program is unsatisfactory, with the first round of Mixture B delayed over two months due to late delivery and transport issues. Application quality needs closer monitoring. (Source: AR 2/2025, Pg. 13-15)",
                        "Agronomic observation": "Harvesting intervals were high in May/June but improved in July/August. Loose fruit collection is incomplete. Pruning quality is acceptable, but progress is slow and frond stacking is inconsistent. Ground vegetation is unsatisfactory with VOPs and woody growth, especially in delayed rehab areas. Rat infestation is minor and under control. (Source: AR 2/2025, Pg. 18, 21, 27, 31, 35, 43)",
                        "Yield performance": "For FY24/25, yield was 21.62 mt/ha (+4% vs prev. year). YTD Aug 2025, yield is 8.37 mt/ha (+7% vs prev. year). Limiting factors include fertilizer delays, incomplete crop recovery in rehab areas, and poor road/ground maintenance. (Source: AR 2/2025, Pg. 49, 51-53)",
                        "Fertilizer recommendation": "The fertilizer program for FY25/26 remains unchanged. The program for FY26/27 has been drawn up. Sub-soil application will be extended. (Source: AR 2/2025, Pg. 54)"
                    },
                    "audit": {
                        "Overall Rating": "Marginally Deficient. Key controls lacked consistency or effectiveness. (Source: Audit, Pg. 2)",
                        "Oil Palm (FFB Quality)": "High FFB rejection by external millers, averaging 3% from Apr-Jul 2025. Site visit found rotten, empty, and unripe bunches. Caused by lack of compliance, inefficient supervision, and incentive systems based only on productivity, not quality. (Source: Audit, Pg. 3, 5, 8)",
                        "Vehicle Running & Workshop": "Weaknesses in handling vehicle documentation. Instances of low utilization (1-2 hours) with full daily pay, duplicate wage charges to a single vehicle, and payments to drivers for vehicles that were broken down. (Source: Audit, Pg. 12, 14, 15)",
                        "Management Response (FFB)": "Acknowledge issues. Action plan includes ceasing recycling of rejected FFB, retraining harvesters, enhancing field supervision, and proposing a review of the harvesting incentive to include quality KPIs. (Source: Audit, Pg. 10-11)",
                        "Management Response (Vehicle)": "Acknowledge issues. Action plan includes strict enforcement of log book maintenance, implementing monthly reconciliation, and ensuring payment controls are based on verified usage. (Source: Audit, Pg. 17-18)"
                    },
                    "pinfosys": "Not Available"
                },
                "policy": " <div class='policy-item'><p class='font-semibold'>Weed Control</p><p class='text-sm text-gray-600'><b>Policy Ref: WEED-VOP-03:</b> Implement a dedicated and systematic control program, including at least one special round focused solely on VOP eradication, when infestation becomes alarming. <b>PA Rec:</b> Adopt CDA spraying immediately.</p></div> <div class='policy-item'><p class='font-semibold'>Manuring & Fertilizing</p><p class='text-sm text-gray-600'><b>Policy Ref: FERT-APP-05:</b> Fertilizer application must adhere to the schedule. Delays over 15 days require a mitigation plan. Improve application quality and supervision to prevent wastage.</p></div> <div class='policy-item'><p class='font-semibold'>Pruning & Harvesting</p><p class='text-sm text-gray-600'><b>Policy Ref: HARV-STD-02:</b> Maintain harvesting intervals below 15 days. Improve harvester productivity through training and motivation. Eliminate harvesting of unripe bunches.</p></div>"
            };


            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                document.getElementById('header-title').innerText = `${estateData.name} Report`;
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' :
                                       metric.title.includes('Audit') ? 'bg-red-50 text-red-800' :
                                       metric.title.includes('Labour') ? 'bg-purple-50 text-purple-800' : 'bg-yellow-50 text-yellow-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                const productionChartHTML = (estate.chartData.production.labels && estate.chartData.production.labels.length > 0) || (estate.chartData.production.rainfall && estate.chartData.production.rainfall.length > 0) ?
                    `<div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div>` :
                    `<div class="chart-container flex items-center justify-center bg-gray-50 rounded-lg p-4"><p class="text-gray-500 text-center">A monthly Production vs. Rainfall chart cannot be generated as monthly FFB production data is not available in the reports.</p></div>`;

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production vs Rainfall (5 Months)</h3>${productionChartHTML}<p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        
                        <div class="mb-8">
                            <h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3>
                            <ul id="observations-list" class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul>
                        </div>
                        
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-audit" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Audit Report Details</button>
                            <div id="${estate.id}-audit" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx && ((estateData.chartData.production.labels && estateData.chartData.production.labels.length > 0) || (estateData.chartData.production.rainfall && estateData.chartData.production.rainfall.length > 0))) {
                    const datasets = [];
                    if (estateData.chartData.production.ffb && estateData.chartData.production.ffb.length > 0) {
                        datasets.push({ label: 'FFB Production (MT)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#ca8a04', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 });
                    }
                    if (estateData.chartData.production.rainfall && estateData.chartData.production.rainfall.length > 0) {
                        datasets.push({ label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' });
                    }

                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: datasets
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx && estateData.chartData.ageProfile.data && estateData.chartData.ageProfile.data.length > 0) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#047857', '#34d399', '#a7f3d0'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: false }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                const auditDiv = document.getElementById(`${estateData.id}-audit`);
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);

                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                
                if (auditDiv && estateData.reports.audit && estateData.reports.audit !== "Not Available") {
                    auditDiv.innerHTML = Object.entries(estateData.reports.audit).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                } else if (auditDiv) {
                    auditDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }

                if (pinfosysDiv && estateData.reports.pinfosys === "Not Available") {
                    pinfosysDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                } else if (pinfosysDiv && estateData.reports.pinfosys) {
                     pinfosysDiv.innerHTML = Object.entries(estateData.reports.pinfosys).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                } else if (pinfosysDiv) {
                    pinfosysDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        const isActive = content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active', isActive);
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', () => openPolicyModal(estateData));
            }

            renderEstate();
        });
        
        function openPolicyModal(estate) {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            modalTitle.innerText = `Agricultural Policy Cross-Reference: ${estate.name}`;
            modalContent.innerHTML = estate.policy;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
