<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Leong Hin San Estate - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; } /* dark green */
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div id="header-title" class="text-xl font-bold text-gray-900">
                <!-- Title will be populated by JS -->
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "leonghinsan",
                "name": "Leong Hin San Estate",
                "reportInfo": "Data based on PA Report (July 2025) & Agronomy Report (June 2025).",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area",
                        "lines": [
                            "Total Planted: 761.16 ha",
                            "Mature: 761.16 ha",
                            "Old (>20 Yrs): 429 ha (56%)"
                        ]
                    },
                    "yield": {
                        "title": "Yield/Ha (FY 24/25)",
                        "value": "32.10 MT",
                        "note": "5.2% above previous year"
                    },
                    "cost": {
                        "title": "FFB Cost/Tonne (FY 24/25)",
                        "value": "RM 265.60",
                        "note": "3% lower than budget"
                    },
                    "weeding": {
                        "title": "Weeding Progress",
                        "value": "Behind Schedule",
                        "note": "Circle (64%), Selective (68%)"
                    },
                     "manuring": {
                        "title": "Manuring Progress",
                        "value": "Completed",
                        "note": "Some delays of 1-3 months noted"
                    }
                },
                "keyMetrics": [
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>`, "label": "P&D Status", "value": "Ganoderma is significant" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>`, "label": "Harvester Productivity", "value": "3.0 MT/md (Acceptable)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>`, "label": "Worker Ratio", "value": "1 : 10 ha (Surplus)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-indigo-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M21.75 8.25-13.5 2.25m0 0L2.25 8.25m11.25-6v6m-11.25 0v6m11.25 0-11.25 6m11.25-6v6m6-3.75-1.5-1.5m0 0L18 8.25m-1.5-1.5V6.375c0-.621.504-1.125 1.125-1.125H21' /></svg>`, "label": "Harvester Ratio", "value": "1 : 17 ha (Excessive)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>`, "label": "Weeding Condition", "value": "Acceptable, needs improvement" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>`, "label": "Harvest Interval", "value": "<20 days (Acceptable)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4' /></svg>`, "label": "Barn Owl Occupancy", "value": "25% (Decreased)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-pink-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01' /></svg>`, "label": "Harvesting Cost", "value": "RM 115 / tonne" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec", "Jan", "Feb", "Mar", "Apr"],
                        "ffb": [2375, 2038, 1947, 2125, 1805, 2269, 2300, 1845, 1705, 1895, 1795, 2430],
                        "rainfall": [275, 158, 146, 172, 189, 118, 244, 149, 75, 91, 73, 361.5],
                        "note": "*Source: AR Pg. 49, 59."
                    },
                    "ageProfile": {
                        "labels": ["0-3 Yrs", "4-7 Yrs", "8-19 Yrs (Prime)", "20-25 Yrs (Old)", ">26 Yrs"],
                        "data": [0, 0, 332, 429, 0],
                        "title": "Leong Hin San Estate - Palm Age Distribution (Ha)",
                        "note": "*Source: AR 1/2025, Pg. 10."
                    }
                },
                "observations": [
                    "<b>Significant Ganoderma Infection:</b> Ganoderma is a major concern, causing significant loss of productive palms. Infection rates exceed 5% in most fields, with some over 10%. Palm mounding is in progress to mitigate losses. <span class='observation-ref'>(AR Pg. 43-44)</span>",
                    "<b>Aging Palm Profile:</b> 56% of the estate's palms (429 ha) are in the 20-25 year old category. While yields are still high, this indicates a future need for a replanting strategy. <span class='observation-ref'>(AR Pg. 10)</span>",
                    "<b>Weeding Program Behind Schedule:</b> Both circle and selective weeding programs are behind schedule, having completed only about 2 out of 3 budgeted rounds. Circle conditions are suboptimal in several blocks. <span class='observation-ref'>(AR Pg. 33-34; PA Pg. 21)</span>",
                    "<b>Incomplete Loose Fruit Collection:</b> While harvesting standards are generally acceptable, there are instances of incomplete loose fruit collection, especially where palm circles have debris, leading to potential crop loss. <span class='observation-ref'>(AR Pg. 22-23)</span>",
                    "<b>High Vehicle Running Costs:</b> The running costs for all farm tractors exceed the budget, primarily due to frequent breakdowns, low running hours, and significant repair costs (e.g., RM 80,000 for a crane overhaul). <span class='observation-ref'>(PA Pg. 50-51)</span>",
                    "<b>Low Barn Owl Occupancy:</b> The barn owl box occupancy rate has dropped to a low 25%. A replacement and maintenance program for damaged boxes is underway to improve biological rat control. <span class='observation-ref'>(PA Pg. 33)</span>"
                ],
                "reports": {
                    "plantation": {
                        "Executive Summary": "The estate's performance is satisfactory, with crop production at 32.10 tons/ha, exceeding budget. The cost of production is also satisfactory at RM 265.60/tonne. Key areas for improvement include worker productivity, completing the palm base mounding program, and maintaining road conditions. <span class='observation-ref'>(PA Pg. 53-54)</span>",
                        "Area Statement": "Total planted area is 761.16 ha, all mature. 56% of palms are over 20 years old. No replanting is scheduled for the next 2 financial years due to manageable harvesting and good yields from older blocks. <span class='observation-ref'>(PA Pg. 10-11)</span>",
                        "Labour Statement": "The estate has 77 workers, a ratio of 1:10 ha, which is considered a surplus. The harvester ratio is 1:17 ha, also excessive given the use of mechanised in-field collection. <span class='observation-ref'>(PA Pg. 14-15)</span>",
                        "Staff Establishment": "The staff complement of one Assistant Manager, one Field Supervisor, and two clerks is satisfactory. A replacement for a trainee Field Supervisor is needed. <span class='observation-ref'>(PA Pg. 13)</span>",
                        "General Charges": "Total expenditure was RM 1,621 per hectare, 1% lower than budget and considered acceptable. Overspending in some areas like Staff Accommodation and Labour Recruitment was justified. <span class='observation-ref'>(PA Pg. 16-18)</span>",
                        "Upkeep Cultivation": "Total weeding cost was RM 190.35/ha, 28% below budget due to postponing one round of spraying. Manuring cost was RM 1,507.25/ha, 21% below budget due to lower material costs. <span class='observation-ref'>(PA Pg. 20, 31)</span>",
                        "Harvesting and Collection": "Total harvesting cost was RM 115/tonne, 6% above budget. This was mainly due to high internal transport costs from vehicle repairs. Harvester productivity is 3.0 MT/man-day. <span class='observation-ref'>(PA Pg. 43-44)</span>",
                        "Crop Production": "FFB yield for FY 24/25 was 32.10 MT/ha, which is 17% above the budget of 27.07 MT/ha. This performance is satisfactory. <span class='observation-ref'>(PA Pg. 48)</span>",
                        "Production Cost": "The ex-estate cost of production is RM 265.60 per tonne, which is 3% lower than budget and considered satisfactory, mainly due to high crop production. <span class='observation-ref'>(PA Pg. 49)</span>",
                        "Vehicles Running Cost": "Running costs for all seven farm tractors are over budget due to frequent breakdowns, low running hours, and high repair costs. More efficient maintenance is needed. <span class='observation-ref'>(PA Pg. 50-52)</span>",
                        "Capital Expenditure": "N/A",
                        "Immature": "N/A"
                    },
                    "agronomy": {
                        "Executive Summary": "Yield performance has been satisfactory. Overall field vegetation has improved but further work is needed. The quality of palm mounding needs improvement. Manuring was completed, though with some delays. <span class='observation-ref'>(AR Pg. 4-6)</span>",
                        "Nutrient inputs progress of manuring": "The FY2024/25 fertilizer program was 100% completed, though most applications were delayed by 1-2 months. The fertilizer store condition has improved. <span class='observation-ref'>(AR Pg. 13-15)</span>",
                        "Agronomic observation": "Harvesting intervals are acceptable (<20 days). Loose fruit collection needs improvement. Pruning is acceptable. Weeding is behind schedule, with circle conditions being suboptimal in some areas. <span class='observation-ref'>(AR Pg. 20, 22, 26, 34)</span>",
                        "Yield performance": "The estate yielded 32.10 MT/ha in FY2024/25, a 5.2% increase from the previous year, which is satisfactory. Crop recovery has been good, but loose fruit collection can be improved. <span class='observation-ref'>(AR Pg. 48-49)</span>",
                        "Fertilizer recommendation": "The fertilizer programme for FY2025/26 should be maintained without amendment. The next program will be formulated after the October 2025 visit. <span class='observation-ref'>(AR Pg. 52)</span>"
                    }
                },
                "policy": " <div class='policy-item'><p class='font-semibold'>Pest & Disease (Ganoderma)</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-Gano-01:</b> Continue the program of palm mounding for Ganoderma-infected palms in younger fields (2010, 2011, 2012 plantings) to prolong their productive life. Ensure mounding is done with adequate, well-compacted soil. <span class='observation-ref'>(AR Pg. 45; PA Pg. 35)</span></p></div> <div class='policy-item'><p class='font-semibold'>Weeding & Ground Cover</p><p class='text-sm text-gray-600'><b>Policy Ref: WEED-CON-02:</b> The estate must catch up on the delayed weeding schedule. Prioritize circle weeding to facilitate loose fruit collection and continue with inter-row spraying to eradicate remaining noxious weeds. <span class='observation-ref'>(AR Pg. 34; PA Pg. 21)</span></p></div> <div class='policy-item'><p class='font-semibold'>Vehicle Maintenance</p><p class='text-sm text-gray-600'><b>Policy Ref: INFRA-VEH-01:</b> Review the maintenance program for all farm tractors to address the frequent breakdowns and high repair costs that are impacting internal transport and overall expenditure. Assess the viability of replacing older units. <span class='observation-ref'>(PA Pg. 50-52)</span></p></div>"
            };


            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                document.getElementById('header-title').innerText = `${estateData.name} Report`;
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' :
                                       metric.title.includes('Weeding') ? 'bg-red-50 text-red-800' : 'bg-yellow-50 text-yellow-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                const productionChartHTML = (estate.chartData.production.labels && estate.chartData.production.labels.length > 0) || (estate.chartData.production.rainfall && estate.chartData.production.rainfall.length > 0) ?
                    `<div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div>` :
                    `<div class="chart-container flex items-center justify-center bg-gray-50 rounded-lg p-4"><p class="text-gray-500 text-center">A monthly Production vs. Rainfall chart cannot be generated as monthly FFB production data is not available in the reports.</p></div>`;

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production (MT) vs Rainfall (mm)</h3>${productionChartHTML}<p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile (Ha)</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        
                        <div class="mb-8">
                            <h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Agronomy & Plantation Issues</h3>
                            <ul id="observations-list" class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul>
                        </div>
                        
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                     chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                {
                                    label: 'FFB Production (MT)',
                                    data: estateData.chartData.production.ffb,
                                    type: 'line',
                                    borderColor: '#ca8a04',
                                    backgroundColor: 'transparent',
                                    yAxisID: 'y-ffb',
                                    tension: 0.4,
                                    fill: false,
                                    pointRadius: 5,
                                    borderWidth: 2
                                },
                                {
                                    label: 'Rainfall (mm)',
                                    data: estateData.chartData.production.rainfall,
                                    backgroundColor: '#3b82f6',
                                    yAxisID: 'y-rainfall'
                                }
                            ]
                        },
                        options: { 
                            responsive: true, 
                            maintainAspectRatio: false, 
                            scales: { 
                                x: { grid: { display: false } }, 
                                'y-ffb': { 
                                    type: 'linear', 
                                    position: 'left', 
                                    title: { display: true, text: 'FFB Production (MT)' }
                                }, 
                                'y-rainfall': { 
                                    type: 'linear', 
                                    position: 'right', 
                                    title: { display: true, text: 'Rainfall (mm)' }, 
                                    grid: { drawOnChartArea: false } 
                                } 
                            } 
                        }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx && estateData.chartData.ageProfile.data && estateData.chartData.ageProfile.data.length > 0) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ 
                                data: estateData.chartData.ageProfile.data, 
                                backgroundColor: ['#a3e635', '#4d7c0f', '#16a34a', '#f97316', '#be123c'], 
                                hoverOffset: 4 
                            }]
                        },
                        options: { 
                            responsive: true, 
                            maintainAspectRatio: false, 
                            plugins: { 
                                title: { 
                                    display: true,
                                    text: estateData.chartData.ageProfile.title
                                }, 
                                legend: { 
                                    position: 'right' 
                                } 
                            } 
                        }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        const isActive = content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active', isActive);
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', () => openPolicyModal(estateData));
            }

            renderEstate();
        });
        
        function openPolicyModal(estate) {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            modalTitle.innerText = `Agricultural Policy Cross-Reference: ${estate.name}`;
            modalContent.innerHTML = estate.policy;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
