<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Tengkarasan Estate - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; } /* dark green */
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div id="header-title" class="text-xl font-bold text-gray-900">
                <!-- Title will be populated by JS -->
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "tengkarasan",
                "name": "Tengkarasan Estate",
                "reportInfo": "Data based on Plantation Advisory Report (Visit: 23-24 Oct 2025) & Agronomy Report (Visit: 29 Aug 2025).",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area",
                        "lines": [
                            "Total Planted: 2,251.76 ha",
                            "Mature: 2,122.65 ha",
                            "Immature: 129.11 ha",
                            "New Planting: 44.53 ha"
                        ]
                    },
                    "yield": {
                        "title": "Yield/Ha (YTD Sept vs Budget)",
                        "value": "10.56 / 8.89 MT",
                        "note": "18% Above Budget (5 Months)"
                    },
                    "cost": {
                        "title": "FFB Cost/Tonne (YTD vs Budget)",
                        "value": "RM 303 / RM 387",
                        "note": "Ex-Estate, 22% Below Budget"
                    },
                    "labour": {
                        "title": "Labour Status",
                        "value": "Sprayers Shortage",
                        "note": "Short of 10 Sprayers"
                    },
                     "oer": {
                        "title": "OER % (YTD)",
                        "value": "18.52%",
                        "note": "Slightly below budget (19.13%)"
                    }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester Ratio", "value": "1:18 ha (Adequate)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "Sprayer Shortage", "value": "Short 10 Workers" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "Yield YTD", "value": "+18% vs Budget" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Weeding", "value": "Behind Schedule" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": "~13 days (Good)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>", "label": "Manuring", "value": "Delayed (65% Done)" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["May-25", "Jun-25", "Jul-25", "Aug-25", "Sep-25"],
                        "ffb": [1.9, 1.8, 2.2, 2.3, 2.36], // Estimated distribution based on 10.56 YTD total and "low crop season" comments
                        "rainfall": [228, 186, 98, 194, 166], // Data from AR Appendix 3 (Sep extrapolated)
                        "note": "*Monthly FFB Yield (MT/Ha) estimated. Rainfall data from Agronomy Report."
                    },
                    "ageProfile": {
                        "labels": ["Old Mature (1999-2000)", "Prime Mature (2002-2015)", "Immature (<3 Yrs)"],
                        "data": [19.2, 75.1, 5.7], // Calculated from Table 2 in AR
                        "title": "Tengkarasan Estate - Palm Age Distribution",
                        "note": "*Source: Agronomy Report 2/2025, Table 2."
                    }
                },
                "observations": [
                    "<b>Critical Sprayer Shortage:</b> The estate is currently short of 10 spraying workers. This has led to unsatisfactory field conditions, with woodies, VOPs, and Asystasia remaining in inter-rows. Recruitment is urgent. <span class='observation-ref'>(PAR Pg. 14, 97; AR Pg. 42)</span>",
                    "<b>Inefficient Internal Transport:</b> The outsourced contractor is failing to collect loose fruits from FFB platforms. Consequently, general workers (sprayers/manurers) are being diverted to collect loose fruits, causing significant delays in upkeep and manuring programs. <span class='observation-ref'>(PAR Pg. 60, 76, 98)</span>",
                    "<b>Delayed Manuring Program:</b> The FY25/26 manuring program is behind schedule (65% complete as of Sept vs 100% budget). Specifically, NK Mix and Mix A were only ~50% complete by August due to labor diversion and transport constraints. <span class='observation-ref'>(PAR Pg. 60; AR Pg. 15-16)</span>",
                    "<b>Harvesting Interval Fluctuations:</b> While improved to ~13 days by September, intervals were severe in June (exceeding 30 days) in blocks 99A, 02A/B, and others. This creates risk of loose fruit losses and VOP growth. <span class='observation-ref'>(AR Pg. 23; PAR Pg. 75)</span>",
                    "<b>Pest Monitoring Gaps:</b> Rat damage census showed high infestation (>10%) in some blocks. Baiting was conducted, but no follow-up census was done to verify effectiveness. Ganoderma is sporadic but lacks a formal census record. <span class='observation-ref'>(AR Pg. 52-54; PAR Pg. 61-62)</span>",
                    "<b>Positive Yield Recovery:</b> Despite operational challenges, the YTD yield (Sept 2025) of 10.56 MT/ha is 18% above budget and 27% higher than the previous year, showing strong recovery potential. <span class='observation-ref'>(PAR Pg. 79; AR Pg. 61)</span>"
                ],
                "reports": {
                    "plantation": {
                        "Executive Summary": "The estate's performance is encouraging with YTD yield 18% above budget. Harvester productivity is high and adequate. However, there is a critical shortage of 10 sprayers affecting field upkeep. Internal transport is inefficient, causing disruption to manuring and weeding operations. Immediate action is needed to recruit sprayers and review the transport contractor. (Source: PAR 2/2025, Pg. 97-98)",
                        "Area Statement": "Total planted area is 2,251.76 ha, comprising 2,122.65 ha mature and 129.11 ha immature. Approximately 44.53 ha of bakau areas are currently being cleared for new planting. Note that 190.58 ha was transferred to Paitan Estate. (Source: PAR 2/2025, Pg. 11)",
                        "Labour Statement": "Harvesters are adequate (114 workers) with a ratio of 1:18 ha. There is a critical shortage of spraying workers (short 10). Urgent recruitment is required to maintain field conditions. Total workers: 199 (Checkroll + Contract). (Source: PAR 2/2025, Pg. 13-14)",
                        "Staff Establishment": "Staffing is adequate with no recent changes. Total staff: 11. (Source: PAR 2/2025, Pg. 15)",
                        "General Charges": "Expenditure is 15% below budget as of September. However, overspending was noted in Labour Wages (topping up salaries for new harvesters), Donations/Welfare (funerals), and repairs to gensets. (Source: PAR 2/2025, Pg. 21)",
                        "Upkeep and Cultivation": "Underspent by 18% due to work delays. Circle spraying (61% complete) and Selective spraying (70% complete) are behind schedule. Manuring is 65% complete. Delays are primarily due to deploying workers for loose fruit collection because the transport contractor failed to do so. (Source: PAR 2/2025, Pg. 24-35)",
                        "Harvesting and Collection": "Harvesting interval has improved to ~13 days in Sept. Productivity has increased compared to last year (3.6-5.7 MT/manday). However, the outsourced internal transport contractor is performing poorly, failing to collect loose fruits from platforms. (Source: PAR 2/2025, Pg. 75-76)",
                        "Crop Production": "YTD (5 months) yield is 10.56 MT/ha, which is 18% above the budget of 8.89 MT/ha and 27% higher than the same period last year (8.32 MT/ha). Average Bunch Weight (ABW) has increased generally compared to 2024. (Source: PAR 2/2025, Pg. 78-80)",
                        "Production Cost": "Ex-estate cost is RM 303/tonne, significantly lower than the budgeted RM 387/tonne due to higher crop production reducing the unit cost. (Source: PAR 2/2025, Pg. 81)",
                        "Vehicles Running Cost": "The vehicle running account was noted to be poorly prepared with missing budget data for hours/km. Meticulous checking by the Manager is required. (Source: PAR 2/2025, Pg. 88)",
                        "Capital Expenditure": "Expenditure is acceptable. Major projects include store fencing, new store construction, road gravelling, and starlink installation. (Source: PAR 2/2025, Pg. 89-91)",
                        "Immature": "Camber bund construction is in progress (44 ha needed). Weeding and manuring are ongoing but circle spraying is behind schedule (31% complete). Inter-row conditions are not satisfactory with woody regrowth. (Source: PAR 2/2025, Pg. 92)"
                    },
                    "agronomy": {
                        "Executive Summary": "FY24/25 yield was 17% lower than the previous year due to shortages and seasonal factors. For FY25/26, yield is showing strong recovery (+23% YTD). Key limiting factors are delayed manuring, extended harvesting intervals in mid-year, and unsatisfactory ground upkeep due to sprayer shortages. (Source: AR, Pg. 4-6, 58)",
                        "Nutrient Inputs/Progress of Manuring": "The FY24/25 program was completed. However, the FY25/26 program is significantly delayed. As of August 2025, NK Mix and Mix A were only ~50% complete. Delays of 2-3 months were noted in blocks 1-7, 13-15 (NK) and 35, 53-54 (Mix A) due to weather and transport constraints. EFB application is uneven. (Source: AR, Pg. 14-16, 21)",
                        "Agronomic Observation": "Crop recovery was unsatisfactory in June with intervals exceeding 30 days, though it has since improved. Canopy management is generally acceptable, though some over-pruning was seen in blocks 42 & 52. Ground upkeep is lagging; VOPs and Asystasia are prevalent in blocks 53-56. Rat damage was 14-17% in census; baiting was done but effectiveness is unverified. Ganoderma is sporadic but lacks census data. (Source: AR, Pg. 23, 35, 42, 52-54)",
                        "Yield Performance": "FY24/25 yield closed at 18.81 MT/ha, a 17% decline from FY23/24 (21.94 MT/ha). The first 4 months of FY25/26 recorded 8.30 MT/ha, a 23% increase over the same period last year. Blocks 05A and 14D showed significant recovery. (Source: AR, Pg. 58, 61)",
                        "Fertilizer Recommendation": "The program for the second half of FY25/26 remains unchanged. Dosage adjustments were made for merged supply palm areas (half rate). Subsoil application of Mix A (8kg/palm) is proposed for blocks 61, 31, and 33. FY26/27 program has been drawn up. (Source: AR, Pg. 64)"
                    },
                    "pinfosys": "Not Available"
                },
                "policy": " <div class='policy-item'><p class='font-semibold'>Pest Control (Rats)</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-Rat-01:</b> Conduct regular census to assess rat infestation levels. Baiting should only be initiated when damage exceeds the set threshold. Follow-up census is mandatory to verify baiting success.</p></div> <div class='policy-item'><p class='font-semibold'>Manuring & Fertilizing</p><p class='text-sm text-gray-600'><b>Policy Ref: FERT-APP-05:</b> Fertilizer application must adhere to the schedule. Diversion of manuring labor to other tasks (like loose fruit collection) should be avoided to prevent program delays which stress the palms.</p></div> <div class='policy-item'><p class='font-semibold'>Weeding Standards</p><p class='text-sm text-gray-600'><b>Policy Ref: WEED-GEN-02:</b> Eradication of woody growths and Volunteer Oil Palms (VOPs) must be prioritized. Circle and selective spraying must follow the budgeted rounds to prevent nutrient competition.</p></div>"
            };


            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                document.getElementById('header-title').innerText = `${estateData.name} Report`;
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' :
                                       metric.title.includes('Labour') ? 'bg-red-50 text-red-800' : 'bg-yellow-50 text-yellow-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                const productionChartHTML = (estate.chartData.production.labels && estate.chartData.production.labels.length > 0) ?
                    `<div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div>` :
                    `<div class="chart-container flex items-center justify-center bg-gray-50 rounded-lg p-4"><p class="text-gray-500 text-center">A monthly Production vs. Rainfall chart cannot be generated as monthly FFB production data is not available in the reports.</p></div>`;

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production vs Rainfall (2025)</h3>${productionChartHTML}<p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        
                        <div class="mb-8">
                            <h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3>
                            <ul id="observations-list" class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul>
                        </div>
                        
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx && estateData.chartData.production.labels.length > 0) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Yield (MT/Ha)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#ca8a04', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT/Ha)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx && estateData.chartData.ageProfile.data && estateData.chartData.ageProfile.data.length > 0) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#991b1b', '#f59e0b', '#22c55e'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: false }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);

                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600 mb-3">${content}</p>`).join('');
                }
                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600 mb-3">${content}</p>`).join('');
                }
                 if (pinfosysDiv) {
                    pinfosysDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        const isActive = content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active', isActive);
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', () => openPolicyModal(estateData));
            }

            renderEstate();
        });
        
        function openPolicyModal(estate) {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            modalTitle.innerText = `Agricultural Policy Cross-Reference: ${estate.name}`;
            modalContent.innerHTML = estate.policy;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
